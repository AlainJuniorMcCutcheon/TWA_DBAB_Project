#:import Factory kivy.factory.Factory

<WelcomeScreen>:
    BoxLayout:
        orientation: 'vertical'
        padding: 50
        spacing: 20

        Label:
            text: 'Welcome'
            font_size: 32
            bold: True
            halign: 'center'

        Button:
            text: 'Login'
            size_hint_y: None
            height: 50
            on_press:
                root.manager.current = 'login'
                root.manager.transition.direction = 'left'

        Button:
            text: 'Register'
            size_hint_y: None
            height: 50
            on_press:
                root.manager.current = 'register'
                root.manager.transition.direction = 'left'

<RegisterScreen>:
    BoxLayout:
        orientation: 'vertical'
        padding: 50
        spacing: 20

        Label:
            text: 'Register'
            font_size: 24
            halign: 'center'

        TextInput:
            hint_text: 'Email'
            id: email
            multiline: False
            input_type: 'text'
            write_tab: False

        TextInput:
            hint_text: 'Password'
            id: password
            password: True
            multiline: False
            write_tab: False

        TextInput:
            hint_text: 'First Name'
            id: first_name
            multiline: False
            write_tab: False

        TextInput:
            hint_text: 'Last Name'
            id: last_name
            multiline: False
            write_tab: False

        BoxLayout:
            spacing: 10
            size_hint_y: None
            height: 50
            Button:
                text: 'Submit'
                on_press: app.register_guest()
            Button:
                text: 'Cancel'
                on_press:
                    root.manager.current = 'welcome'
                    root.manager.transition.direction = 'right'

        Label:
            id: error_label
            text: ''
            color: 1, 0, 0, 1
            size_hint_y: None
            height: 30

<LoginScreen>:
    BoxLayout:
        orientation: 'vertical'
        padding: 50
        spacing: 20

        Label:
            text: 'Please Sign In'
            font_size: 24
            halign: 'center'

        TextInput:
            hint_text: 'Email'
            id: email
            multiline: False
            input_type: 'text'
            write_tab: False

        TextInput:
            hint_text: 'Password'
            id: password
            password: True
            multiline: False
            write_tab: False

        BoxLayout:
            spacing: 10
            size_hint_y: None
            height: 50
            Button:
                text: 'Login'
                on_press: app.login_guest()
            Button:
                text: 'Back'
                on_press:
                    root.manager.current = 'welcome'
                    root.manager.transition.direction = 'right'

        Label:
            id: error_label
            text: ''
            color: 1, 0, 0, 1
            size_hint_y: None
            height: 30


<SearchScreen>:
    BoxLayout:
        orientation: 'vertical'
        padding: 20
        spacing: 20

        Label:
            text: 'Search Listings'
            font_size: 24
            halign: 'center'
            size_hint_y: None
            height: 40

        BoxLayout:
            orientation: 'horizontal'
            spacing: 10
            size_hint_y: None
            height: 50

            TextInput:
                hint_text: 'City'
                id: city

            TextInput:
                hint_text: 'Max Price'
                id: max_price
                input_filter: 'int'

            Button:
                text: 'Search'
                size_hint_x: None
                width: 100
                on_press: app.show_listings()
        ScrollView:
            do_scroll_x: False
            do_scroll_y: True

            BoxLayout:
                id: listings_box
                orientation: 'vertical'
                size_hint_y: None
                height: self.minimum_height
                
        Button:
            text: 'Sign Out'
            size_hint_y: None
            height: 50
            on_press: app.logout_guest()

<ReservationScreen>:
    name: 'reservation'
    BoxLayout:
        orientation: 'vertical'
        padding: 20
        spacing: 20
        
        Label:
            text: 'Reservation Details'
            font_size: 24
            bold: True
            halign: 'center'

        
        AsyncImage:
            id: listing_image
            source: 'default.jpg' 
            size_hint: None, None 
            width: 400 
            height: 300 
            allow_stretch: True  
            pos_hint: {'center_x': 0.5, 'center_y': 0.5} 

        Label:
            id: listing_name
            text: 'Listing Name: N/A'

        Label:
            id: listing_price
            text: 'Price: $0.00'

        Label:
            id: listing_location
            text: 'Location: N/A'


        Button:
            text: 'Confirm Reservation'
            on_press: app.confirm_reservation()

        Button:
            text: 'Back to Search'
            on_press: app.root.current = 'search'

<ListingItem@BoxLayout>:
    orientation: 'horizontal'
    spacing: 10
    size_hint_y: None
    height: 120

    AsyncImage:
        source: root.image_source
        size_hint_x: None
        width: 100

    Label:
        text: root.listing_text
        markup: True
        halign: "left"
        valign: "middle"
        text_size: self.size

    Button:
        text: 'Check Availability'
        size_hint_x: None
        width: 160
        on_press: app.check_availability(root.listing_data)

